<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>365å­˜éŒ¢éŒ¢ğŸ“</title>
    <style>
        :root {
            --primary: #ff85a1; 
            --secondary: #fbb6ce;
            --lavender: #d8b4fe; 
            --lavender-dark: #a855f7;
            --bg: #fff5f7;
            --text: #702459;
        }
        body {
            font-family: "Microsoft JhengHei", -apple-system, sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(#ffd1dc 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items:center;
            padding: 20px;
            margin: 0;
        }
        .container {
            background: white;
            width: 100%;
            max-width: 400px;
            border-radius: 30px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(255, 133, 161, 0.2);
            border: 3px solid var(--secondary);
            position: relative;
        }
        h1 { text-align: center; font-size: 26px; color: var(--primary); margin-bottom: 20px; font-weight: bold; }
        
        .progress-section {
            margin: 0 auto 25px auto;
            width: 90%;
            padding: 15px 12px;
            background: #fff9fa;
            border-radius: 20px;
            border: 2px solid var(--secondary);
            position: relative;
        }
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 15px;
        }
        .progress-bar-bg {
            background: #f3f4f6;
            height: 12px; 
            border-radius: 10px;
            position: relative;
            border: 1px solid #e5e7eb;
        }
        .progress-bar-fill {
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            height: 100%;
            width: 0%;
            border-radius: 10px;
            position: relative;
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .bow-icon {
            position: absolute;
            right: -15px;
            top: -12px;
            font-size: 24px;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #fff0f3;
            padding: 12px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--secondary);
        }
        .stat-label { font-size: 13px; color: var(--primary); font-weight: bold; margin-bottom: 4px; }
        .stat-value { font-size: 18px; font-weight: 900; color: var(--primary); }

        .extra-box {
            background: #faf5ff;
            border: 2px solid var(--lavender); 
            border-radius: 18px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        input {
            width: 45%;
            padding: 8px 10px;
            border-radius: 10px;
            border: 1.5px solid var(--lavender);
            outline: none;
            font-size: 15px;
        }
        .btn-ok {
            background: var(--lavender);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 10px;
            font-weight: bold;
        }

        .action-btns {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .btn-history {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 6px 18px; /* ç¨å¾®è®Šå°ä¸€é» */
            border-radius: 25px;
            font-weight: bold;
            font-size: 13px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }
        .day {
            aspect-ratio: 1;
            background: white;
            border: 1px solid var(--secondary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: var(--secondary);
        }
        .day.checked {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ç´€éŒ„è¦–çª—å„ªåŒ– */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%;
            max-width: 360px;
        }
        .modal-content {
            background: white;
            width: 100%;
            border-radius: 25px;
            padding: 20px;
            max-height: 65vh;
            overflow-y: auto;
            border: 3px solid var(--primary);
            box-sizing: border-box;
        }
        .modal-title {
            color: var(--primary);
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--bg);
            padding-bottom: 10px;
        }
        .history-item {
            display: flex;
            flex-direction: column;
            padding: 12px 5px;
            border-bottom: 1px solid #f0f0f0;
        }
        .history-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-bottom {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }
        .history-type { font-weight: bold; font-size: 15px; }
        .type-save { color: var(--primary); }      /* å­˜éŒ¢ç²‰è‰² */
        .type-extra { color: var(--lavender-dark); } /* åŠ ç¢¼ç´«è‰² */
        
        .history-date { font-size: 12px; color: #aaa; background: #f8f8f8; padding: 2px 8px; border-radius: 5px; }
        .btn-edit-date {
            background: none;
            border: 1px solid var(--lavender);
            color: var(--lavender-dark);
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 5px;
            font-weight: bold;
        }
        .btn-del-single { background: none; border: none; font-size: 18px; cursor: pointer; padding: 0; }
        
        /* é—œé–‰æŒ‰éˆ•ç§»åˆ°è¦–çª—å¤–é¢ */
        .btn-close-outer {
            margin-top: 20px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 40px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ“ 365å­˜éŒ¢éŒ¢ ğŸ“</h1>
    
    <div class="progress-section">
        <div class="progress-text">
            <span>å®Œæˆæ¯”ç‡</span>
            <span id="percentText">0%</span>
        </div>
        <div class="progress-bar-bg">
            <div class="progress-bar-fill" id="barFill">
                <span class="bow-icon">ğŸ€</span>
            </div>
        </div>
    </div>

    <div class="stats">
        <div class="stat-card">
            <div class="stat-label">ç´¯ç©ç¸½é‡‘é¡</div>
            <div class="stat-value" id="totalDisplay">$0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">å®Œæˆå¤©æ•¸</div>
            <div class="stat-value" id="progressDisplay">0 å¤©</div>
        </div>
    </div>

    <div class="extra-box">
        <div class="stat-label" style="color:var(--lavender-dark); margin-bottom:8px;">ğŸ° é¡å¤–åŠ ç¢¼ ğŸ°</div>
        <input type="number" id="extraInput" placeholder="é‡‘é¡">
        <button class="btn-ok" onclick="addExtra()">OK</button>
    </div>

    <div class="action-btns">
        <button class="btn-history" onclick="toggleModal(true)">ğŸ“‹ æŸ¥çœ‹ç´€éŒ„</button>
    </div>

    <div class="grid" id="grid"></div>
</div>

<div id="historyModal" class="modal">
    <div class="modal-wrapper">
        <div class="modal-content">
            <div class="modal-title">ğŸ“– å­˜éŒ¢å°æœ¬æœ¬</div>
            <div id="historyList"></div>
        </div>
        <button class="btn-close-outer" onclick="toggleModal(false)">é—œé–‰</button>
    </div>
</div>

<script>
    let savedDays = JSON.parse(localStorage.getItem('v12_days') || '[]');
    let extraMoney = parseInt(localStorage.getItem('v12_extra') || '0');
    let logs = JSON.parse(localStorage.getItem('v12_logs') || '[]');

    function update() {
        const gridSum = savedDays.reduce((a, b) => a + b, 0);
        const total = gridSum + extraMoney;
        const count = savedDays.length;
        const percent = Math.round((count / 365) * 100);

        document.getElementById('totalDisplay').innerText = '$' + total.toLocaleString();
        document.getElementById('progressDisplay').innerText = count + ' å¤©';
        document.getElementById('percentText').innerText = percent + '%';
        document.getElementById('barFill').style.width = percent + '%';
        
        localStorage.setItem('v12_days', JSON.stringify(savedDays));
        localStorage.setItem('v12_extra', extraMoney);
        localStorage.setItem('v12_logs', JSON.stringify(logs));
        renderLogs();
    }

    function addLog(type, amount, dayNum = null) {
        const now = new Date();
        const dateStr = `${now.getMonth()+1}/${now.getDate()}`;
        const displayName = type === 'å­˜éŒ¢' ? 'å­˜éŒ¢éŒ¢' : 'åŠ ç¢¼';
        logs.unshift({ type: displayName, amount, date: dateStr, dayNum, id: Date.now() });
        update();
    }

    function addExtra() {
        const input = document.getElementById('extraInput');
        const val = parseInt(input.value);
        if (val) { 
            extraMoney += val; 
            addLog('åŠ ç¢¼', val);
            input.value = ''; 
        }
    }

    function editLogDate(id) {
        const idx = logs.findIndex(l => l.id === id);
        if (idx > -1) {
            const newDate = prompt("è«‹è¼¸å…¥æ–°æ—¥æœŸ (ä¾‹å¦‚: 1/2)", logs[idx].date);
            if (newDate) {
                logs[idx].date = newDate;
                update();
            }
        }
    }

    function deleteSingleLog(id) {
        const idx = logs.findIndex(l => l.id === id);
        if (idx > -1) {
            const item = logs[idx];
            if (item.type === 'å­˜éŒ¢éŒ¢') {
                savedDays = savedDays.filter(d => d !== item.dayNum);
                const dayEl = document.getElementById('day-' + item.dayNum);
                if(dayEl) dayEl.classList.remove('checked');
            } else if (item.type === 'åŠ ç¢¼') {
                extraMoney -= item.amount;
            }
            logs.splice(idx, 1);
            update();
        }
    }

    function renderLogs() {
        const list = document.getElementById('historyList');
        if (logs.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#ccc; margin-top:30px;">å°šç„¡ç´€éŒ„ ğŸ“</div>';
            return;
        }
        list.innerHTML = logs.map(l => {
            const typeClass = l.type === 'å­˜éŒ¢éŒ¢' ? 'type-save' : 'type-extra';
            const amountColor = l.type === 'å­˜éŒ¢éŒ¢' ? 'var(--primary)' : 'var(--lavender-dark)';
            return `
            <div class="history-item">
                <div class="history-top">
                    <span class="history-type ${typeClass}">${l.type}</span>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="color:${amountColor}; font-weight:800;">+$${l.amount.toLocaleString()}</span>
                        <button class="btn-del-single" onclick="deleteSingleLog(${l.id})">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="history-bottom">
                    <span class="history-date">${l.date}</span>
                    <button class="btn-edit-date" onclick="editLogDate(${l.id})">ğŸ“… ä¿®æ”¹æ—¥æœŸ</button>
                </div>
            </div>
        `; }).join('');
    }

    function toggleModal(show) {
        document.getElementById('historyModal').style.display = show ? 'flex' : 'none';
    }

    const grid = document.getElementById('grid');
    for (let i = 1; i <= 365; i++) {
        const div = document.createElement('div');
        div.id = 'day-' + i;
        div.className = 'day' + (savedDays.includes(i) ? ' checked' : '');
        div.innerText = i;
        div.onclick = () => {
            if (savedDays.includes(i)) {
                savedDays = savedDays.filter(d => d !== i);
                logs = logs.filter(l => !(l.type === 'å­˜éŒ¢éŒ¢' && l.dayNum === i));
                div.classList.remove('checked');
            } else {
                savedDays.push(i);
                addLog('å­˜éŒ¢', i, i);
                div.classList.add('checked');
            }
            update();
        };
        grid.appendChild(div);
    }
    update();
</script>
</body>
</html>
